// Time is: 2026-02-20T23:03:40.285Z
import{connect as M}from"cloudflare:sockets";var B={userID:"be0ff9df-1468-41a0-8865-796d1c6800db",proxyIPs:["nima.nscl.ir:443"],scamalytics:{username:"revilseptember",apiKey:"b2fc368184deb3d8ac914bd776b8215fe899dd8fef69fbaba77511acfbdeca0d",baseUrl:"https://api12.scamalytics.com/v3/"},socks5:{enabled:!1,relayMode:!1,address:""},fromEnv(e){let t=e.PROXYIP||this.proxyIPs[Math.floor(Math.random()*this.proxyIPs.length)],[a,r="443"]=t.split(":");return{userID:e.UUID||this.userID,proxyIP:a,proxyPort:r,proxyAddress:t,scamalytics:{username:e.SCAMALYTICS_USERNAME||this.scamalytics.username,apiKey:e.SCAMALYTICS_API_KEY||this.scamalytics.apiKey,baseUrl:e.SCAMALYTICS_BASEURL||this.scamalytics.baseUrl},socks5:{enabled:!!e.SOCKS5,relayMode:e.SOCKS5_RELAY==="true"||this.socks5.relayMode,address:e.SOCKS5||this.socks5.address}}}},A={ED_PARAMS:{ed:2560,eh:"Sec-WebSocket-Protocol"},AT_SYMBOL:"@",VLESS_PROTOCOL:"vless",WS_READY_STATE_OPEN:1,WS_READY_STATE_CLOSING:2};function U(e=18,t=""){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="";for(let n=0;n<e;n++)r+=a.charAt(Math.floor(Math.random()*a.length));return`/${r}${t?`?${t}`:""}`}var Y={xray:{tls:{path:()=>U(12,"ed=2560"),security:"tls",fp:"chrome",alpn:"http/1.1",extra:{}},tcp:{path:()=>U(12,"ed=2560"),security:"none",fp:"chrome",extra:{}}},sb:{tls:{path:()=>U(18),security:"tls",fp:"chrome",alpn:"http/1.1",extra:A.ED_PARAMS},tcp:{path:()=>U(18),security:"none",fp:"chrome",extra:A.ED_PARAMS}}};function V(e,t){return`${e}-${t.toUpperCase()}`}function K({userID:e,address:t,port:a,host:r,path:n,security:c,sni:s,fp:i,alpn:o,extra:u={},name:p}){let d=new URLSearchParams({type:"ws",host:r,path:n});c&&(d.set("security",c),c==="tls"&&d.set("allowInsecure","1")),s&&d.set("sni",s),i&&d.set("fp",i),o&&d.set("alpn",o);for(let[f,l]of Object.entries(u))d.set(f,l);return`vless://${e}@${t}:${a}?${d.toString()}#${encodeURIComponent(p)}`}function x({core:e,proto:t,userID:a,hostName:r,address:n,port:c,tag:s}){let i=Y[e][t];return K({userID:a,address:n,port:c,host:r,path:i.path(),security:i.security,sni:i.security==="tls"?G(r):void 0,fp:i.fp,alpn:i.alpn,extra:i.extra,name:V(s,t)})}var I=e=>e[Math.floor(Math.random()*e.length)];async function v(e,t,a,r){let c=new URL(e.url).searchParams.get("name"),s={total_TB:380,base_GB:42e3,daily_growth_GB:250,expire_date:"2028-4-20"},i=[r,"creativecommons.org","2027.victoriacross.ir","sky.rethinkdns.com","www.speedtest.net","cfip.xxxxxxxx.tk","yakamoz.nscl.ir","chat.openai.com","go.inmobi.com","singapore.com","www.visa.com","www.wto.org","chatgpt.com","nodejs.org","zzula.ir","csgo.com","fbi.gov"],o=[443,8443,2053,2083,2087,2096],u=[80,8080,8880,2052,2082,2086,2095],p=[],d=r.endsWith(".pages.dev");i.forEach((S,b)=>{p.push(x({core:t,proto:"tls",userID:a,hostName:r,address:S,port:I(o),tag:`D${b+1}`})),d||p.push(x({core:t,proto:"tcp",userID:a,hostName:r,address:S,port:I(u),tag:`D${b+1}`}))});try{let S=await fetch("https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json");if(S.ok){let b=await S.json();[...b.ipv4||[],...b.ipv6||[]].slice(0,20).map(E=>E.ip).forEach((E,T)=>{let L=E.includes(":")?`[${E}]`:E;p.push(x({core:t,proto:"tls",userID:a,hostName:r,address:L,port:I(o),tag:`IP${T+1}`})),d||p.push(x({core:t,proto:"tcp",userID:a,hostName:r,address:L,port:I(u),tag:`IP${T+1}`}))})}}catch(S){console.error("Fetch IP list failed",S)}let f=1024*1024*1024,l=1024*f,h=s.total_TB*l,y=s.base_GB*f,m=new Date,g=(m.getHours()+m.getMinutes()/60)/24*(s.daily_growth_GB*f),P=y+g/2,D=y+g/2,R=Math.floor(new Date(s.expire_date).getTime()/1e3),_={"Content-Type":"text/plain;charset=utf-8","Profile-Update-Interval":"6","Subscription-Userinfo":`upload=${Math.round(D)}; download=${Math.round(P)}; total=${h}; expire=${R}`};return c&&(_["Profile-Title"]=c),new Response(btoa(p.join(`
`)),{headers:_})}async function H(e,t){let a=new WebSocketPair,[r,n]=Object.values(a);n.accept();let c="",s="",i=null,o=(l,h)=>{console.log(`[${c}:${s}] ${l}`,h||"")},u=e.headers.get("Sec-WebSocket-Protocol")||"",p=F(n,u,o),d={value:null},f=!1;return p.pipeTo(new WritableStream({async write(l,h){if(i)return i.write(l);if(d.value){let b=d.value.writable.getWriter();await b.write(l),b.releaseLock();return}let{hasError:y,message:m,addressType:C,portRemote:g=443,addressRemote:P="",rawDataIndex:D,ProtocolVersion:R=new Uint8Array([0,0]),isUDP:$}=z(l,t.userID);if(c=P,s=`${g}--${Math.random()} ${$?"udp":"tcp"} `,y)throw new Error(m);let _=new Uint8Array([R[0],0]),S=l.slice(D);if($){if(g===53)i=(await J(n,_,o)).write,i(S);else throw new Error("UDP proxy is only enabled for DNS (port 53)");return}j(d,C,P,g,S,n,_,o,t)},close(){o("readableWebSocketStream closed")},abort(l){o("readableWebSocketStream aborted",l)}})).catch(l=>{console.error("Pipeline failed:",l.stack||l)}),new Response(null,{status:101,webSocket:r})}function N(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function G(e){let t="";for(let a=0;a<e.length;a++)t+=Math.random()<.5?e[a].toUpperCase():e[a].toLowerCase();return t}async function j(e,t,a,r,n,c,s,i,o){o||(o={userID:"d342d11e-d424-4583-b36e-524ab1f0afa4",socks5Address:"",socks5Relay:!1,proxyIP:"nima.nscl.ir",proxyPort:"443",enableSocks:!1,parsedSocks5Address:{}});async function u(f,l,h=!1){let y;o.socks5Relay?y=await O(t,f,l,i,o.parsedSocks5Address):y=h?await O(t,f,l,i,o.parsedSocks5Address):M({hostname:f,port:l}),e.value=y,i(`connected to ${f}:${l}`);let m=y.writable.getWriter();return await m.write(n),m.releaseLock(),y}async function p(){let f=o.enableSocks?await u(a,r,!0):await u(o.proxyIP||a,o.proxyPort||r,!1);f.closed.catch(l=>{console.log("retry tcpSocket closed error",l)}).finally(()=>{k(c)}),W(f,c,s,null,i)}let d=await u(a,r);W(d,c,s,p,i)}function F(e,t,a){return new ReadableStream({start(r){e.addEventListener("message",s=>r.enqueue(s.data)),e.addEventListener("close",()=>{k(e),r.close()}),e.addEventListener("error",s=>{a("webSocketServer has error"),r.error(s)});let{earlyData:n,error:c}=X(t);c?r.error(c):n&&r.enqueue(n)},pull(r){},cancel(r){a(`ReadableStream was canceled, due to ${r}`),k(e)}})}function z(e,t){if(e.byteLength<24)return{hasError:!0,message:"invalid data"};let a=new DataView(e),r=a.getUint8(0),n=Q(new Uint8Array(e.slice(1,17)));if(!t.split(",").map(y=>y.trim()).some(y=>n===y))return{hasError:!0,message:"invalid user"};let i=a.getUint8(17),o=a.getUint8(18+i);if(o!==1&&o!==2)return{hasError:!0,message:`command ${o} is not supported`};let u=18+i+1,p=a.getUint16(u),d=a.getUint8(u+2),f,l,h;switch(d){case 1:l=4,h=u+3,f=new Uint8Array(e.slice(h,h+l)).join(".");break;case 2:l=a.getUint8(u+3),h=u+4,f=new TextDecoder().decode(e.slice(h,h+l));break;case 3:l=16,h=u+3,f=Array.from({length:8},(y,m)=>a.getUint16(h+m*2).toString(16)).join(":");break;default:return{hasError:!0,message:`invalid addressType: ${d}`}}return f?{hasError:!1,addressRemote:f,addressType:d,portRemote:p,rawDataIndex:h+l,ProtocolVersion:new Uint8Array([r]),isUDP:o===2}:{hasError:!0,message:`addressValue is empty, addressType is ${d}`}}async function W(e,t,a,r,n){let c=!1;try{await e.readable.pipeTo(new WritableStream({async write(s){if(t.readyState!==A.WS_READY_STATE_OPEN)throw new Error("WebSocket is not open");c=!0;let i=a?await new Blob([a,s]).arrayBuffer():s;t.send(i),a=null},close(){n(`Remote connection readable closed. Had incoming data: ${c}`)},abort(s){console.error("Remote connection readable aborted:",s)}}))}catch(s){console.error("RemoteSocketToWS error:",s.stack||s),k(t)}!c&&r&&(n("No incoming data, retrying"),await r())}function X(e){if(!e)return{earlyData:null,error:null};try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/")),a=new ArrayBuffer(t.length),r=new Uint8Array(a);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return{earlyData:a,error:null}}catch(t){return{earlyData:null,error:t}}}function k(e){try{(e.readyState===A.WS_READY_STATE_OPEN||e.readyState===A.WS_READY_STATE_CLOSING)&&e.close()}catch(t){console.error("safeCloseWebSocket error:",t)}}var w=Array.from({length:256},(e,t)=>(t+256).toString(16).slice(1));function q(e,t=0){return(w[e[t]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]).toLowerCase()}function Q(e,t=0){let a=q(e,t);if(!N(a))throw new TypeError("Stringified UUID is invalid");return a}async function J(e,t,a){let r=!1,n=new TransformStream({transform(s,i){for(let o=0;o<s.byteLength;){let u=s.slice(o,o+2),p=new DataView(u).getUint16(0),d=new Uint8Array(s.slice(o+2,o+2+p));o=o+2+p,i.enqueue(d)}}});n.readable.pipeTo(new WritableStream({async write(s){try{let o=await(await fetch("https://1.1.1.1/dns-query",{method:"POST",headers:{"content-type":"application/dns-message"},body:s})).arrayBuffer(),u=o.byteLength,p=new Uint8Array([u>>8&255,u&255]);e.readyState===A.WS_READY_STATE_OPEN&&(a(`DNS query successful, length: ${u}`),r?e.send(await new Blob([p,o]).arrayBuffer()):(e.send(await new Blob([t,p,o]).arrayBuffer()),r=!0))}catch(i){a("DNS query error: "+i)}}})).catch(s=>{a("DNS stream error: "+s)});let c=n.writable.getWriter();return{write:s=>c.write(s)}}async function O(e,t,a,r,n){let{username:c,password:s,hostname:i,port:o}=n,u=M({hostname:i,port:o}),p=u.writable.getWriter(),d=u.readable.getReader(),f=new TextEncoder;await p.write(new Uint8Array([5,2,0,2]));let l=(await d.read()).value;if(l[0]!==5||l[1]===255)throw new Error("SOCKS5 server connection failed.");if(l[1]===2){if(!c||!s)throw new Error("SOCKS5 auth credentials not provided.");let m=new Uint8Array([1,c.length,...f.encode(c),s.length,...f.encode(s)]);if(await p.write(m),l=(await d.read()).value,l[0]!==1||l[1]!==0)throw new Error("SOCKS5 authentication failed.")}let h;switch(e){case 1:h=new Uint8Array([1,...t.split(".").map(Number)]);break;case 2:h=new Uint8Array([3,t.length,...f.encode(t)]);break;case 3:h=new Uint8Array([4,...t.split(":").flatMap(m=>[parseInt(m.slice(0,2),16),parseInt(m.slice(2),16)])]);break;default:throw new Error(`Invalid addressType for SOCKS5: ${e}`)}let y=new Uint8Array([5,1,0,...h,a>>8,a&255]);if(await p.write(y),l=(await d.read()).value,l[1]!==0)throw new Error("Failed to open SOCKS5 connection.");return p.releaseLock(),d.releaseLock(),u}function Z(e){try{let[t,a]=e.includes("@")?e.split("@"):[null,e],[r,n]=a.split(":"),c=parseInt(n,10);if(!r||isNaN(c))throw new Error;let s,i;if(t&&([s,i]=t.split(":"),!s))throw new Error;return{username:s,password:i,hostname:r,port:c}}catch{throw new Error("Invalid SOCKS5 address format. Expected [user:pass@]host:port")}}function ee(e,t,a){let r=x({core:"xray",proto:"tls",userID:e,hostName:t,address:t,port:443,tag:`${t}-Xray`}),n=x({core:"sb",proto:"tls",userID:e,hostName:t,address:t,port:443,tag:`${t}-Singbox`}),c=encodeURIComponent("INDEX"),s=`https://${t}/xray/${e}?name=${c}`,i=`https://${t}/sb/${e}?name=${c}`,o=`<!doctype html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>VLESS Proxy Configuration</title><link rel="icon" href="https://raw.githubusercontent.com/NiREvil/zizifn/refs/heads/Legacy/assets/raven-1.png" type="image/png" /><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet" /><style> * { margin: 0; padding: 0; box-sizing: border-box; } @font-face { font-family: "Aldine 401 BT Web"; src: url("https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/Aldine401_Mersedeh.woff2") format("woff2"); font-weight: 400; font-style: normal; font-display: swap; } @font-face { font-family: "Styrene B LC"; src: url("https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/StyreneBLC-Regular.woff2") format("woff2"); font-weight: 400; font-style: normal; font-display: swap; } @font-face { font-family: "Styrene B LC"; src: url("https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/StyreneBLC-Medium.woff2") format("woff2"); font-weight: 500; font-style: normal; font-display: swap; } :root { --background-primary: #2a2421; --background-secondary: #35302c; --background-tertiary: #413b35; --border-color: #5a4f45; --border-color-hover: #766a5f; --text-primary: #e5dfd6; --text-secondary: #b3a89d; --text-accent: #ffffff; --accent-primary: #be9b7b; --accent-secondary: #d4b595; --accent-tertiary: #8d6e5c; --accent-primary-darker: #8a6f56; --button-text-primary: #2a2421; --button-text-secondary: var(--text-primary); --shadow-color: rgba(0, 0, 0, 0.35); --shadow-color-accent: rgba(190, 155, 123, 0.4); --border-radius: 8px; --transition-speed: 0.2s; --transition-speed-fast: 0.1s; --transition-speed-medium: 0.3s; --transition-speed-long: 0.6s; --status-success: #70b570; --status-error: #e05d44; --status-warning: #e0bc44; --status-info: #4f90c4; --serif: "Aldine 401 BT Web", "Times New Roman", Times, Georgia, ui-serif, serif; --sans-serif: "Styrene B LC", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, "Noto Color Emoji", sans-serif; --mono-serif: "Fira Code", Cantarell, "Courier Prime", monospace; } body { font-family: var(--sans-serif); font-size: 16px; font-weight: 400; font-style: normal; background-color: var(--background-primary); color: var(--text-primary); padding: 3rem; line-height: 1.5; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; } .container { max-width: 800px; margin: 20px auto; padding: 0 12px; border-radius: var(--border-radius); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2), 0 0 25px 8px var(--shadow-color-accent); transition: box-shadow var(--transition-speed-medium) ease; } .container:hover { box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25), 0 0 35px 10px var(--shadow-color-accent); } .header { text-align: center; margin-bottom: 40px; padding-top: 30px; } .header h1 { font-family: var(--serif); font-weight: 400; font-size: 2rem; color: var(--text-accent); margin-top: 0px; margin-bottom: 2px; } .header p { color: var(--text-secondary); font-size: 0.8rem; font-weight: 400; } .config-card { background: var(--background-secondary); border-radius: var(--border-radius); padding: 20px; margin-bottom: 24px; border: 1px solid var(--border-color); transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease; } .config-card:hover { border-color: var(--border-color-hover); box-shadow: 0 4px 8px var(--shadow-color); } .config-title { font-family: var(--serif); font-size: 1.4rem; font-weight: 400; color: var(--accent-secondary); margin-bottom: 16px; padding-bottom: 13px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; } .config-title .refresh-btn { position: relative; overflow: hidden; display: flex; align-items: center; gap: 4px; font-family: var(--serif); font-size: 12px; padding: 6px 12px; border-radius: 6px; color: var(--accent-secondary); background-color: var(--background-tertiary); border: 1px solid var(--border-color); cursor: pointer; transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease; } .config-title .refresh-btn::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.2), transparent); transform: translateX(-100%); transition: transform var(--transition-speed-long) ease; z-index: 1; } .config-title .refresh-btn:hover { letter-spacing: 0.5px; font-weight: 600; background-color: #4d453e; color: var(--accent-primary); border-color: var(--border-color-hover); transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); } .config-title .refresh-btn:hover::before { transform: translateX(100%); } .config-title .refresh-btn:active { transform: translateY(0px) scale(0.98); box-shadow: none; } .refresh-icon { width: 12px; height: 12px; stroke: currentColor; } .config-content { position: relative; background: var(--background-tertiary); border-radius: var(--border-radius); padding: 16px; margin-bottom: 20px; border: 1px solid var(--border-color); } .config-content pre { overflow-x: auto; font-family: var(--mono-serif); font-size: 12px; color: var(--text-primary); margin: 0; white-space: pre-wrap; word-break: break-all; } .button { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 16px; border-radius: var(--border-radius); font-size: 15px; font-weight: 500; cursor: pointer; border: 1px solid var(--border-color); background-color: var(--background-tertiary); color: var(--button-text-secondary); transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease; -webkit-tap-highlight-color: transparent; touch-action: manipulation; text-decoration: none; overflow: hidden; z-index: 1; } .button:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; } .button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; transition: opacity var(--transition-speed) ease; } .copy-buttons { position: relative; display: flex; gap: 4px; overflow: hidden; align-self: center; font-family: var(--serif); font-size: 13px; padding: 6px 12px; border-radius: 6px; color: var(--accent-secondary); border: 1px solid var(--border-color); transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease, transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease; } .copy-buttons::before, .client-btn::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.2), transparent); transform: translateX(-100%); transition: transform var(--transition-speed-long) ease; z-index: -1; } .copy-buttons:hover::before, .client-btn:hover::before { transform: translateX(100%); } .copy-buttons:hover { background-color: #4d453e; letter-spacing: 0.5px; font-weight: 600; border-color: var(--border-color-hover); transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); } .copy-buttons:active { transform: translateY(0px) scale(0.98); box-shadow: none; } .copy-icon { width: 12px; height: 12px; stroke: currentColor; } .client-buttons { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px; margin-top: 16px; } .client-btn { width: 100%; background-color: var(--accent-primary); color: var(--background-tertiary); border-radius: 6px; border-color: var(--accent-primary-darker); position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); } .client-btn::after { content: ""; position: absolute; bottom: -5px; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, var(--accent-tertiary), var(--accent-secondary)); opacity: 0; transition: all 0.3s ease; z-index: 0; } .client-btn:hover { text-transform: uppercase; letter-spacing: 0.3px; transform: translateY(-3px); background-color: var(--accent-secondary); color: var(--button-text-primary); box-shadow: 0 5px 15px rgba(190, 155, 123, 0.5); border-color: var(--accent-secondary); } .client-btn:hover::after { opacity: 1; bottom: 0; } .client-btn:active { transform: translateY(0) scale(0.98); box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2); background-color: var(--accent-primary-darker); } .client-btn .client-icon { position: relative; z-index: 2; transition: transform 0.3s ease; } .client-btn:hover .client-icon { transform: rotate(15deg) scale(1.1); } .client-btn .button-text { position: relative; z-index: 2; transition: letter-spacing 0.3s ease; } .client-btn:hover .button-text { letter-spacing: 0.5px; } .client-icon { width: 18px; height: 18px; border-radius: 6px; background-color: var(--background-secondary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; } .client-icon svg { width: 14px; height: 14px; fill: var(--accent-secondary); } .button.copied { background-color: var(--accent-secondary) !important; color: var(--background-tertiary) !important; } .button.error { background-color: #c74a3b !important; color: var(--text-accent) !important; } .footer { text-align: center; margin-top: 20px; padding-bottom: 40px; color: var(--text-secondary); font-size: 12px; } .footer p { margin-bottom: 0px; } ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { background: var(--background-primary); border-radius: 4px; } ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; border: 2px solid var(--background-primary); } ::-webkit-scrollbar-thumb:hover { background: var(--border-color-hover); } * { scrollbar-width: thin; scrollbar-color: var(--border-color) var(--background-primary); } .ip-info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 24px; } .ip-info-section { background-color: var(--background-tertiary); border-radius: var(--border-radius); padding: 16px; border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 20px; } .ip-info-header { display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; } .ip-info-header svg { width: 20px; height: 20px; stroke: var(--accent-secondary); } .ip-info-header h3 { font-family: var(--serif); font-size: 18px; font-weight: 400; color: var(--accent-secondary); margin: 0; } .ip-info-content { display: flex; flex-direction: column; gap: 10px; } .ip-info-item { display: flex; flex-direction: column; gap: 2px; } .ip-info-item .label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; } .ip-info-item .value { font-size: 14px; color: var(--text-primary); word-break: break-all; line-height: 1.4; } .badge { display: inline-flex; align-items: center; justify-content: center; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; } .badge-yes { background-color: rgba(112, 181, 112, 0.15); color: var(--status-success); border: 1px solid rgba(112, 181, 112, 0.3); } .badge-no { background-color: rgba(224, 93, 68, 0.15); color: var(--status-error); border: 1px solid rgba(224, 93, 68, 0.3); } .badge-neutral { background-color: rgba(79, 144, 196, 0.15); color: var(--status-info); border: 1px solid rgba(79, 144, 196, 0.3); } .badge-warning { background-color: rgba(224, 188, 68, 0.15); color: var(--status-warning); border: 1px solid rgba(224, 188, 68, 0.3); } .skeleton { display: block; background: linear-gradient( 90deg, var(--background-tertiary) 25%, var(--background-secondary) 50%, var(--background-tertiary) 75% ); background-size: 200% 100%; animation: loading 1.5s infinite; border-radius: 4px; height: 16px; } @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } } .country-flag { display: inline-block; width: 18px; height: auto; max-height: 14px; margin-right: 6px; vertical-align: middle; border-radius: 2px; } .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; } .modal-overlay.visible { opacity: 1; visibility: visible; } .modal-overlay.visible { opacity: 1; visibility: visible; } .modal-content { background: var(--background-secondary); padding: 24px; border-radius: var(--border-radius); border: 1px solid var(--border-color); width: 90%; max-width: 450px; text-align: center; box-shadow: 0 8px 30px var(--shadow-color-accent); transform: scale(0.95); transition: transform 0.3s ease; } .modal-overlay.visible .modal-content { transform: scale(1); } .modal-title { font-family: var(--serif); font-size: 1.5rem; color: var(--accent-secondary); margin-bottom: 16px; } .modal-text { color: var(--text-primary); font-size: 14px; line-height: 1.6; margin-bottom: 20px; } .modal-instruction { background: var(--background-tertiary); padding: 12px; border-radius: 6px; margin-bottom: 24px; font-size: 13px; line-height: 1.8; border: 1px solid var(--border-color); } .modal-instruction code { background: var(--background-primary); color: var(--accent-primary); padding: 3px 6px; border-radius: 4px; font-family: var(--mono-serif); } #hiddify-modal-continue { width: 100%; } @media (max-width: 768px) { body { padding: 20px; } .container { padding: 0 14px; width: min(100%, 768px); } .ip-info-grid { grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 18px; } .header h1 { font-size: 1.8rem; } .header p { font-size: 0.7rem; } .ip-info-section { padding: 14px; gap: 18px; } .ip-info-header h3 { font-size: 16px; } .ip-info-header { gap: 8px; } .ip-info-content { gap: 8px; } .ip-info-item .label { font-size: 11px; } .ip-info-item .value { font-size: 13px; } .config-card { padding: 16px; } .config-title { font-size: 18px; } .config-title .refresh-btn { font-size: 11px; } .config-content pre { font-size: 12px; } .client-buttons { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); } .button { font-size: 12px; } .copy-buttons { font-size: 11px; } } @media (max-width: 480px) { body { padding: 16px; } .container { padding: 0 12px; width: min(100%, 390px); } .header h1 { font-size: 20px; } .header p { font-size: 8px; } .ip-info-section { padding: 14px; gap: 16px; } .ip-info-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; } .ip-info-header h3 { font-size: 14px; } .ip-info-header { gap: 6px; } .ip-info-content { gap: 6px; } .ip-info-header svg { width: 18px; height: 18px; } .ip-info-item .label { font-size: 9px; } .ip-info-item .value { font-size: 11px; } .badge { padding: 2px 6px; font-size: 10px; border-radius: 10px; } .config-card { padding: 10px; } .config-title { font-size: 16px; } .config-title .refresh-btn { font-size: 10px; } .config-content { padding: 12px; } .config-content pre { font-size: 10px; } .client-buttons { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); } .button { padding: 4px 8px; font-size: 11px; } .copy-buttons { font-size: 10px; } .footer { font-size: 10px; } } @media (max-width: 359px) { body { padding: 12px; font-size: 14px; } .container { max-width: 100%; padding: 8px; } .header h1 { font-size: 16px; } .header p { font-size: 6px; } .ip-info-section { padding: 12px; gap: 12px; } .ip-info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; } .ip-info-header h3 { font-size: 13px; } .ip-info-header { gap: 4px; } .ip-info-content { gap: 4px; } .ip-info-header svg { width: 16px; height: 16px; } .ip-info-item .label { font-size: 8px; } .ip-info-item .value { font-size: 10px; } .badge { padding: 1px 4px; font-size: 9px; border-radius: 8px; } .config-card { padding: 8px; } .config-title { font-size: 13px; } .config-title .refresh-btn { font-size: 9px; } .config-content { padding: 8px; } .config-content pre { font-size: 8px; } .client-buttons { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); } .button { padding: 3px 6px; font-size: 10px; } .copy-buttons { font-size: 9px; } .footer { font-size: 8px; } } @media (min-width: 360px) { .container { max-width: 95%; } } @media (min-width: 480px) { .container { max-width: 90%; } } @media (min-width: 640px) { .container { max-width: 600px; } } @media (min-width: 768px) { .container { max-width: 720px; } } @media (min-width: 1024px) { .container { max-width: 800px; } } </style></head><body data-proxy-ip="{{PROXY_ADDRESS}}"><div class="container"><div class="header"><h1>VLESS Proxy Configuration</h1><p>Copy the configuration or import directly into your client</p></div><div class="config-card"><div class="config-title"><span>Xray Core Clients</span></div><div class="config-content"><pre id="xray-config">{{CONFIG_DREAM}}</pre></div><div class="client-buttons"><a href="{{URL_HIDDIFY}}" class="button client-btn">Import to Hiddify</a><a href="{{URL_V2RAYNG}}" class="button client-btn">Import to V2rayNG</a></div></div><div class="config-card"><div class="config-title"><span>Sing-Box Core Clients</span></div><div class="config-content"><pre id="singbox-config">{{CONFIG_FREEDOM}}</pre></div><div class="client-buttons"><a href="{{URL_CLASH}}" class="button client-btn">Import to Clash Meta</a><a href="{{URL_EXCLAVE}}" class="button client-btn">Import to Exclave</a></div></div></div><script> function copyToClipboard(button, text) { const originalHTML = button.innerHTML; navigator.clipboard.writeText(text).then(() => { button.innerHTML = \\\`<svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copied!\\\`; button.classList.add("copied"); button.disabled = true; setTimeout(() => { button.innerHTML = originalHTML; button.classList.remove("copied"); button.disabled = false; }, 1200); }).catch(err => { console.error("Failed to copy text: ", err); }); } async function fetchClientPublicIP() { try { const response = await fetch('https://api.ipify.org?format=json'); if (!response.ok) throw new Error(\\\`HTTP error! status: \\\${response.status}\\\`); return (await response.json()).ip; } catch (error) { console.error('Error fetching client IP:', error); return null; } } async function fetchScamalyticsClientInfo(clientIp) { if (!clientIp) return null; try { const response = await fetch(\\\`/scamalytics-lookup?ip=\\\${encodeURIComponent(clientIp)}\\\`); if (!response.ok) { const errorText = await response.text(); throw new Error(\\\`Worker request failed! status: \\\${response.status}, details: \\\${errorText}\\\`); } const data = await response.json(); if (data.scamalytics && data.scamalytics.status === 'error') { throw new Error(data.scamalytics.error || 'Scamalytics API error via Worker'); } return data; } catch (error) { console.error('Error fetching from Scamalytics via Worker:', error); return null; } } // Extract information from IP databases function updateScamalyticsClientDisplay(data) { const prefix = 'client'; if (!data || !data.scamalytics || data.scamalytics.status !== 'ok') { showError(prefix, (data && data.scamalytics && data.scamalytics.error) || 'Could not load client data from Scamalytics'); return; } const sa = data.scamalytics; const ext = data.external_datasources || {}; // Alternative sources for extracting information const ipinfo = ext.ipinfo || {}; const maxmind = ext.maxmind_geolite2 || {}; const dbip = ext.dbip || {}; const elements = { ip: document.getElementById(\\\`\\\${prefix}-ip\\\`), location: document.getElementById(\\\`\\\${prefix}-location\\\`), isp: document.getElementById(\\\`\\\${prefix}-isp\\\`), proxy: document.getElementById(\\\`\\\${prefix}-proxy\\\`) }; // Helper function for data validation const isValid = (val) => val && val !== "PREMIUM FIELD - upgrade to view" && val.trim() !== ""; // IP display (Your connection) if (elements.ip) elements.ip.textContent = sa.ip || "N/A"; // Show ISP - priority is given to ipinfo let ispName = "N/A"; if (isValid(ipinfo.as_name)) ispName = ipinfo.as_name; else if (isValid(maxmind.as_name)) ispName = maxmind.as_name; else if (isValid(sa.scamalytics_isp)) ispName = sa.scamalytics_isp; else if (isValid(dbip.isp_name)) ispName = dbip.isp_name; if (elements.isp) elements.isp.textContent = ispName; // Show location (city and country) if (elements.location) { let city = ""; let countryName = ""; let countryCode = ""; // Trying to find a city if (isValid(maxmind.ip_city)) city = maxmind.ip_city; else if (isValid(dbip.ip_city)) city = dbip.ip_city; // Trying to find a country if (isValid(ipinfo.ip_country_name)) { countryName = ipinfo.ip_country_name; countryCode = ipinfo.ip_country_code; } else if (isValid(maxmind.ip_country_name)) { countryName = maxmind.ip_country_name; countryCode = maxmind.ip_country_code; } else if (isValid(dbip.ip_country_name)) { countryName = dbip.ip_country_name; countryCode = dbip.ip_country_code; } countryCode = countryCode ? countryCode.toLowerCase() : ''; let flagElementHtml = countryCode ? \\\`<img src="https://flagcdn.com/w20/\\\${countryCode}.png" srcset="https://flagcdn.com/w40/\\\${countryCode}.png 2x" alt="\\\${countryCode}" class="country-flag"> \\\` : ''; let textPart = [city, countryName].filter(Boolean).join(', '); elements.location.innerHTML = (flagElementHtml || textPart) ? \\\`\\\${flagElementHtml}\\\${textPart}\\\`.trim() : "N/A"; } // Show risk score if (elements.proxy) { const score = sa.scamalytics_score; const risk = sa.scamalytics_risk; let riskText = "Unknown"; let badgeClass = "badge-neutral"; if (risk && score !== undefined) { riskText = \\\`\\\${score} - \\\${risk.charAt(0).toUpperCase() + risk.slice(1)}\\\`; switch (risk.toLowerCase()) { case "low": badgeClass = "badge-yes"; break; case "medium": badgeClass = "badge-warning"; break; case "high": case "very high": badgeClass = "badge-no"; break; } } elements.proxy.innerHTML = \\\`<span class="badge \\\${badgeClass}">\\\${riskText}</span>\\\`; } } function updateIpApiIoDisplay(geo, prefix, originalHost) { const hostElement = document.getElementById(\\\`\\\${prefix}-host\\\`); if (hostElement) hostElement.textContent = originalHost || "N/A"; const elements = { ip: document.getElementById(\\\`\\\${prefix}-ip\\\`), location: document.getElementById(\\\`\\\${prefix}-location\\\`), isp: document.getElementById(\\\`\\\${prefix}-isp\\\`) }; if (!geo || geo.error) { const errorMessage = geo ? geo.reason : 'N/A'; Object.values(elements).forEach(el => { if(el) el.innerHTML = errorMessage; }); if (elements.ip) elements.ip.innerHTML = "N/A"; return; } if (elements.ip) elements.ip.textContent = geo.ip || "N/A"; if (elements.location) { const city = geo.city || ''; const countryName = geo.country_name || ''; const countryCode = geo.country_code ? geo.country_code.toLowerCase() : ''; let flagElementHtml = countryCode ? \\\`<img src="https://flagcdn.com/w20/\\\${countryCode}.png" srcset="https://flagcdn.com/w40/\\\${countryCode}.png 2x" alt="\\\${geo.country_code}" class="country-flag"> \\\` : ''; let textPart = [city, countryName].filter(Boolean).join(', '); elements.location.innerHTML = (flagElementHtml || textPart) ? \\\`\\\${flagElementHtml}\\\${textPart}\\\`.trim() : "N/A"; } if (elements.isp) elements.isp.textContent = geo.isp || geo.organization || geo.org || 'N/A'; } async function fetchIpApiIoInfo(ip) { try { const response = await fetch(\\\`https://ipapi.co/\\\${ip}/json/\\\`); if (!response.ok) throw new Error(\\\`HTTP error! status: \\\${response.status}\\\`); return await response.json(); } catch (error) { console.error('IP API Error (ipapi.co):', error); return null; } } function showError(prefix, message = "Could not load data", originalHostForProxy = null) { const errorMessage = "N/A"; const elements = (prefix === 'proxy') ? ['host', 'ip', 'location', 'isp'] : ['ip', 'location', 'isp', 'proxy']; elements.forEach(key => { const el = document.getElementById(\\\`\\\${prefix}-\\\${key}\\\`); if (!el) return; if (key === 'host' && prefix === 'proxy') el.textContent = originalHostForProxy || errorMessage; else if (key === 'proxy' && prefix === 'client') el.innerHTML = \\\`<span class="badge badge-neutral">N/A</span>\\\`; else el.innerHTML = errorMessage; }); console.warn(\\\`\\\${prefix} data loading failed: \\\${message}\\\`); } async function loadNetworkInfo() { try { const proxyIpWithPort = document.body.getAttribute('data-proxy-ip') || "N/A"; const proxyDomainOrIp = proxyIpWithPort.split(':')[0]; const proxyHostEl = document.getElementById('proxy-host'); if(proxyHostEl) proxyHostEl.textContent = proxyIpWithPort; if (proxyDomainOrIp && proxyDomainOrIp !== "N/A") { let resolvedProxyIp = proxyDomainOrIp; if (!/^\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}$/.test(proxyDomainOrIp)) { try { const dnsRes = await fetch(\\\`https://dns.google/resolve?name=\\\${encodeURIComponent(proxyDomainOrIp)}&type=A\\\`); if (dnsRes.ok) { const dnsData = await dnsRes.json(); const ipAnswer = dnsData.Answer?.find(a => a.type === 1); if (ipAnswer) resolvedProxyIp = ipAnswer.data; } } catch (e) { console.error('DNS resolution for proxy failed:', e); } } const proxyGeoData = await fetchIpApiIoInfo(resolvedProxyIp); updateIpApiIoDisplay(proxyGeoData, 'proxy', proxyIpWithPort); } else { showError('proxy', 'Proxy Host not available', proxyIpWithPort); } const clientIp = await fetchClientPublicIP(); if (clientIp) { const clientIpElement = document.getElementById('client-ip'); if(clientIpElement) clientIpElement.textContent = clientIp; const scamalyticsData = await fetchScamalyticsClientInfo(clientIp); updateScamalyticsClientDisplay(scamalyticsData); } else { showError('client', 'Could not determine your IP address.'); } } catch (error) { console.error('Overall network info loading failed:', error); showError('proxy', \\\`Error: \\\${error.message}\\\`, document.body.getAttribute('data-proxy-ip') || "N/A"); showError('client', \\\`Error: \\\${error.message}\\\`); } } document.getElementById('refresh-ip-info')?.addEventListener('click', function() { const button = this; const icon = button.querySelector('.refresh-icon'); button.disabled = true; if (icon) icon.style.animation = 'spin 1s linear infinite'; const resetToSkeleton = (prefix) => { const elementsToReset = ['ip', 'location', 'isp']; if (prefix === 'proxy') elementsToReset.push('host'); if (prefix === 'client') elementsToReset.push('proxy'); elementsToReset.forEach(key => { const element = document.getElementById(\\\`\\\${prefix}-\\\${key}\\\`); if (element) element.innerHTML = \\\`<span class="skeleton" style="width: 120px;"></span>\\\`; }); }; resetToSkeleton('proxy'); resetToSkeleton('client'); loadNetworkInfo().finally(() => setTimeout(() => { button.disabled = false; if (icon) icon.style.animation = ''; }, 1000)); }); const style = document.createElement('style'); style.textContent = \\\`@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\\\`; document.head.appendChild(style); document.addEventListener('DOMContentLoaded', () => { loadNetworkInfo(); const hiddifyBtn = document.getElementById('hiddify-import-btn'); const modal = document.getElementById('hiddify-dns-modal'); const continueBtn = document.getElementById('hiddify-modal-continue'); if (hiddifyBtn && modal && continueBtn) { hiddifyBtn.addEventListener('click', function(event) { event.preventDefault(); modal.style.display = 'flex'; setTimeout(() => modal.classList.add('visible'), 10); }); continueBtn.addEventListener('click', function() { modal.classList.remove('visible'); setTimeout(() => { modal.style.display = 'none'; window.location.href = hiddifyBtn.href; }, 300); }); modal.addEventListener('click', function(event) { if (event.target === modal) { modal.classList.remove('visible'); setTimeout(() => modal.style.display = 'none', 300); } });; } }); <\/script></body></html>`;return o=o.replace(/{{PROXY_ADDRESS}}/g,a).replace(/{{CONFIG_DREAM}}/g,r).replace(/{{CONFIG_FREEDOM}}/g,n).replace(/{{URL_HIDDIFY}}/g,`hiddify://install-config?url=${encodeURIComponent(s)}`).replace(/{{URL_V2RAYNG}}/g,`v2rayng://install-config?url=${encodeURIComponent(s)}#${c}`).replace(/{{URL_CLASH}}/g,`clash://install-config?url=${encodeURIComponent(`https://revil-sub.pages.dev/sub/clash-meta?url=${i}`)}`).replace(/{{URL_EXCLAVE}}/g,`sn://subscription?url=${encodeURIComponent(i)}&name=${c}`),new Response(o,{headers:{"Content-Type":"text/html; charset=utf-8"}})}var ae={async fetch(e,t,a){try{let r=B.fromEnv(t),n=new URL(e.url),c=e.headers.get("Upgrade");if(c&&c.toLowerCase()==="websocket"){let s={userID:r.userID,proxyIP:r.proxyIP,proxyPort:r.proxyPort,socks5Address:r.socks5.address,socks5Relay:r.socks5.relayMode,enableSocks:r.socks5.enabled,parsedSocks5Address:r.socks5.enabled?Z(r.socks5.address):{}};return H(e,s)}return n.pathname==="/scamalytics-lookup"?handleScamalyticsLookup(e,r):n.pathname.startsWith(`/xray/${r.userID}`)?v(e,"xray",r.userID,n.hostname):n.pathname.startsWith(`/sb/${r.userID}`)?v(e,"sb",r.userID,n.hostname):n.pathname.startsWith(`/${r.userID}`)?ee(r.userID,n.hostname,r.proxyAddress):new Response(`UUID not found. Please set the UUID environment variable in the Cloudflare dashboard.
Your Path: `+n.pathname,{status:404})}catch(r){let n=`CRITICAL ERROR:
Message: ${r.message}
Stack: ${r.stack}`;return new Response(n,{status:500,headers:{"content-type":"text/plain"}})}}};export{ae as default};
